/*
 * ê·¸ë¦¼??+ì±???ë°?
 *
 * <?¹ì??¤ë?>
 * 1. ê·???ë§? - ì½¤ë³´ë°??¤ì???? ?´ë??? ?????? ê·? ?¬ë????ê²?ë§? ë§???ê¸?
 * 2. ???´í?? ?¬í?? ???¥ì°½
 * 3. ???? ?¬ì?? ???? ????ëª? ??ë©´ì?? ????
 * 4. ê·¸ë¦¼???? ?????? ì±???ë°©ì?? ?????? ????
 *
 * ??ë²? ?´ë???? - ê°??? ë¨¼ì?? ?¤í???´ì?¼ë??
 */

package newpackage;

import java.io.IOException;
import java.net.ServerSocket;
import java.net.Socket;
import java.util.Vector;

public class PCServer {

    private ServerSocket sS;
    private Socket s;
    private Vector<PCClient> clientList; // ?´ë?¼ì?´ì?¸í?? ë¦¬ì?¤í??

    public PCServer(int port) {
        System.out.println("**??ë²?ë¥? ?????©ë????");
        try {
            sS = new ServerSocket(port); // ???¬ë??? ?¬í?¸ë? ??ë²???ì¼? ????
            clientList = new Vector<PCClient>(); // ?????? ë¦¬ì?¤í?? ê´?ë¦¬ë?? ???? ë²¡í??
        } catch (IOException ex) {
            System.out.println("??ë²???ì¼? ???±ì?? IOException ???¸ì?ë¦?");
        }
    }

    public void exe() {

        while (true) {
            // ??ë²? ?´ë?¼ì?´ì?¸í?¸ë?? ê¸°ë?¤ë¦¼
            try {
                s = sS.accept();
                System.out.println("Client ????");

            } catch (IOException ex1) {
            }

            // ?????? ??ë©? ??ì¼??? ???¬í???? ?´ë?¼ì?´ì?¸í?? ê°?ì²? ????
            PCClient ct = new PCClient(s, this);
            clientList.add(ct); // ?????? ë¦¬ì?¤í?¸ì?? ??ì¼? ?´ë?¼ì?´ì?¸í?? ê°?ì²? ì¶?ê°?
        }
    }

    // ?´ë?¼ì?´ì?¸í?? ???? ë©?????
    public void removeClient(PCClient c) {
        clientList.remove(c);
    }

    // ???? ?????? ????ëª??¤ì?? ???¥í?? ë²¡í??
    Vector<String> conClientList = new Vector<String>();

    // ë©???ì§? ???? ë©?????
    public void sendMsg(String s1, String s2, String s3, String s4, PCClient ct) {
        String type1 = s1; // enter, exit, draw, whisper, talk
        String type2 = s2; // nickName, color, all, someone
        String type3 = s3; // none, x, speaker
        String type4 = s4; // none, y, say
        String str = "";
        PCClient client = ct;

        if (type1.equals("whisper")) { // ê·???ë§?
            for (PCClient c : clientList) {
                if (c.getNickName().equals(type2)) { // ?????? ?????¼ê²½?°ì??ë§?
                    c.getPw().println("[ê·???ë§? from " + type3 + "] " + type4);
                    client.getPw().println("[ê·???ë§? to " + type2 + "] " + type4);
                }
            }
        } else { // ê·???ë§??? ????ê²½ì??
            if (type1.equals("enter")) { // ????
                str = "enter/" + type2;
                String temp = "";
                // ???? ?????? ????ëª? ë¦¬ì?¤í?¸ë?? ????ë¡? ???¥í?´ì??
                for (String sl : conClientList) {
                    temp = temp + "/" + sl;
                }
                // ???¥í?? ??????ê²? ????
                ct.getPw().println(temp);
                conClientList.add(type2); // ?????? ????ëª? ë¦¬ì?¤í?¸ì?? ì¶?ê°?
            } else if (type1.equals("exit")) { // ?´ì??
                str = "exit/" + type2;
                removeClient(client); // ?´ë?¼ì?´ì?¸í?? ëª©ë????? ??ê±?
                conClientList.remove(type2); // ??????ë¦¬ì?¤í?¸ì???? ??ê±?
            } else if (type1.equals("draw")) { // ê·¸ë¦¬ê¸?
                str = "draw/" + type2 + "/" + type3 + "/" + type4;

            } else { // talk ?¼ê²½??
                str = "[" + type3 + "] " + type4;
            }

            // ëª¨ë?? ??????ê²? ???±ë?? ë©???ì§?ë¥? ?¡ì?
            for (PCClient c : clientList) {
                c.getPw().println(str);
            }
        }

    }

    public static void main(String[] args) {
        PCServer sv = new PCServer(7777);
        sv.exe();
    }

   
}
